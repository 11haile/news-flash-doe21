import requests
import json
from pyramid.response import Response
from wsgiref.simple_server import make_server
from pyramid.config import Configurator
def hello_world(request):
    try:
        # Define the URL for the API endpoint
        url = ('https://newsapi.org/v2/everything?'
               'q=Apple&'
               'from=2023-02-24&'
               'sortBy=popularity&'
               'apiKey=a15fbc057aa04e399b3b128a57406996')

        # Define the parameters for the API call
        params = {
            "q": "elonmusk&",
            #"": "value2"
        }

        # Make the API call using the requests library
        response = requests.get(url, params=params)

        # Raise an exception if the API call was unsuccessful
        response.raise_for_status()

        # Parse the JSON response
        data = response.json()

        # Return the data as a response
        return Response(json.dumps(data))
    except requests.exceptions.HTTPError as error:
        # Handle HTTP errors (status codes other than 200)
        return Response(f"API call failed with HTTP error: {error}", status=500)
    except requests.exceptions.RequestException as error:
        # Handle other types of errors (network, DNS, connection, etc.)
        return Response(f"API call failed with error: {error}", status=500)

if __name__ == '__main__':
    with Configurator() as config:
        config.add_route('hello', '/')
        config.add_view(hello_world, route_name='hello')
        app = config.make_wsgi_app()
    server = make_server('0.0.0.0', 6543, app)
    server.serve_forever()
